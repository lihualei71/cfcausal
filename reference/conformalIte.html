<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Conformal inference for individual treatment effects — conformalIte • cfcausal</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Conformal inference for individual treatment effects — conformalIte" />
<meta property="og:description" content="conformalIte supports four algorithms: the nested approach with exact and inexact
calibration for cases with both potential outcomes missing, the naive approach for cases with both potential outcomes missing and the counterfactual
inference for cases with only one potential outcome missing. For each algorithm, it supports both
split conformal inference and CV+, including weighted Jackknife+ as a special case. For each type, it
supports both conformalized quantile regression (CQR) and standard conformal inference based on conditional mean regression." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



<!-- dependencies from examples -->


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfcausal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/cfcausal_demo.html">A Tutorial of `cfcausal` package</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Conformal inference for individual treatment effects</h1>
    
    <div class="hidden name"><code>conformalIte.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>conformalIte</code> supports four algorithms: the nested approach with exact and inexact
calibration for cases with both potential outcomes missing, the naive approach for cases with both potential outcomes missing and the counterfactual
inference for cases with only one potential outcome missing. For each algorithm, it supports both
split conformal inference and CV+, including weighted Jackknife+ as a special case. For each type, it
supports both conformalized quantile regression (CQR) and standard conformal inference based on conditional mean regression.</p>
    </div>

    <pre class="usage"><span class='fu'>conformalIte</span><span class='op'>(</span>
  <span class='va'>X</span>,
  <span class='va'>Y</span>,
  <span class='cn'>T</span>,
  alpha <span class='op'>=</span> <span class='fl'>0.1</span>,
  algo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"nest"</span>, <span class='st'>"naive"</span>, <span class='st'>"counterfactual"</span><span class='op'>)</span>,
  exact <span class='op'>=</span> <span class='cn'>FALSE</span>,
  type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CQR"</span>, <span class='st'>"mean"</span><span class='op'>)</span>,
  side <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"two"</span>, <span class='st'>"above"</span>, <span class='st'>"below"</span><span class='op'>)</span>,
  quantiles <span class='op'>=</span> <span class='cn'>NULL</span>,
  outfun <span class='op'>=</span> <span class='cn'>NULL</span>,
  outparams <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  psfun <span class='op'>=</span> <span class='cn'>NULL</span>,
  psparams <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  cfprop <span class='op'>=</span> <span class='fl'>0.5</span>,
  citype <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CQR"</span>, <span class='st'>"mean"</span><span class='op'>)</span>,
  lofun <span class='op'>=</span> <span class='cn'>NULL</span>,
  loquantile <span class='op'>=</span> <span class='fl'>0.4</span>,
  loparams <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  upfun <span class='op'>=</span> <span class='cn'>NULL</span>,
  upquantile <span class='op'>=</span> <span class='fl'>0.6</span>,
  upparams <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  useCV <span class='op'>=</span> <span class='cn'>FALSE</span>,
  trainprop <span class='op'>=</span> <span class='fl'>0.75</span>,
  nfolds <span class='op'>=</span> <span class='fl'>10</span>,
  wthigh <span class='op'>=</span> <span class='fl'>20</span>,
  wtlow <span class='op'>=</span> <span class='fl'>0.05</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>covariates.</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>observed outcome vector.</p></td>
    </tr>
    <tr>
      <th>T</th>
      <td><p>treatment indicator, a binary vector.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>confidence level.</p></td>
    </tr>
    <tr>
      <th>algo</th>
      <td><p>a string that takes values in {"nest", "naive", "counterfactual"}. See Details.</p></td>
    </tr>
    <tr>
      <th>exact</th>
      <td><p>a logical indicating whether the exact calibration is used for nested approach. Used only when <code>algo = "nest"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>a string that takes values in {"CQR", "mean"}.</p></td>
    </tr>
    <tr>
      <th>side</th>
      <td><p>a string that takes values in {"two", "above", "below"}. See Details.</p></td>
    </tr>
    <tr>
      <th>quantiles</th>
      <td><p>for covariates in the training data. Used only when <code>type = "CQR"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>outfun</th>
      <td><p>a function that models the conditional mean or quantiles, or a valid string. 
The default is random forest when <code>type = "mean"</code> and quantile random forest when
<code>type = "CQR"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>outparams</th>
      <td><p>a list of other parameters to be passed into <code>outfun</code>.</p></td>
    </tr>
    <tr>
      <th>psfun</th>
      <td><p>a function that models the missing mechanism (probability of missing given X), or a valid string. 
The default is "Boosting". See Details.</p></td>
    </tr>
    <tr>
      <th>psparams</th>
      <td><p>a list of other parameters to be passed into <code>psfun</code>.</p></td>
    </tr>
    <tr>
      <th>cfprop</th>
      <td><p>the proportion of units to be used to compute ITE intervals in nested approach. Used only when
<code>algo = "nest"</code>.</p></td>
    </tr>
    <tr>
      <th>citype</th>
      <td><p>the type of interval conformal inference used in the nested approach with exact calibration.
Used only when <code>algo = "nest"</code> and <code>exact = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>lofun</th>
      <td><p>the function to fit the lower bound, or a valid string. Used only when
<code>algo = "nest"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>loquantile</th>
      <td><p>the quantile to fit for <code>lofun</code>; see Details. Used only when
<code>algo = "nest"</code> and <code>citype = "CQR"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>loparams</th>
      <td><p>a list of other parameters to be passed into <code>lofun</code>.</p></td>
    </tr>
    <tr>
      <th>upfun</th>
      <td><p>the function to fit the upper bound, or a valid string. Used only when
<code>algo = "nest"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>upquantile</th>
      <td><p>the quantile to fit for <code>upfun</code>. Used only when
<code>algo = "nest"</code> and <code>citype = "CQR"</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>upparams</th>
      <td><p>a list of other parameters to be passed into <code>upfun</code>.</p></td>
    </tr>
    <tr>
      <th>useCV</th>
      <td><p>FALSE for split conformal inference and TRUE for CV+.</p></td>
    </tr>
    <tr>
      <th>trainprop</th>
      <td><p>proportion of units for training <code>outfun</code>. The default if 75%. Used only when <code>useCV = FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>nfolds</th>
      <td><p>number of folds. The default is 10. Used only when <code>useCV = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>wthigh</th>
      <td><p>upper truncation level of weights. See <code><a href='predict.conformalSplit.html'>predict.conformalSplit</a></code> or <code><a href='predict.conformalCV.html'>predict.conformalCV</a></code>.</p></td>
    </tr>
    <tr>
      <th>wtlow</th>
      <td><p>lower truncation level of weights. See <code><a href='predict.conformalSplit.html'>predict.conformalSplit</a></code> or <code><a href='predict.conformalCV.html'>predict.conformalCV</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a function that outputs the interval estimates on a given dataset. When <code>algo = "nest"</code> or <code>"naive"</code>, it takes
a single input <code>X</code>; when <code>algo = "counterfactual"</code>, it takes three inputs <code>X</code>, <code>Y</code> and <code>T</code>.</p>
<p>#' @seealso
<code><a href='conformal.html'>conformal</a></code>, <code><a href='conformalInt.html'>conformalInt</a></code>, <code><a href='conformalCf.html'>conformalCf</a></code></p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The algorithm to be used is controlled by <code>algo</code> and <code>exact</code>:</p><ul>
<li><p>(Default) when <code>algo = "nest"</code> and <code>exact = FALSE</code>, the inexact nested approach is used. It
first splits the data into two folds, with the second fold including <code>cfprop</code> fraction of units. Then it applies
<code>conformalCf</code> on the first fold to compute counterfactual intervals on the second fold, which further yields
interval estimates of ITE \(\hat{C}(X_i)\). Finally it fits \(\hat{C}^{L}(X_i)\) and \(\hat{C}^{R}(X_i)\) on \(X_i\)'s.</p></li>
<li><p>When <code>algo = "nest"</code> and <code>exact = TRUE</code>, the exact nested approach is used. It has the same steps as the inexact nested approach to produce
ITE intervals \(\hat{C}(X_i)\)'s on the second fold but then applies <code><a href='conformalInt.html'>conformalInt</a></code> to calibrate them.</p></li>
<li><p>When <code>algo = "naive"</code>, the naive approach is used. It applies <code><a href='conformalCf.html'>conformalCf</a></code> on the data and
produce counterfactual intervals for both Y(1) and Y(0). The ITE intervals are computed by contrasting two counterfactual intervals.</p></li>
<li><p>When <code>algo = "counterfactual"</code>, it handles the case where the treatment assignments and the observed outcome are
both available for each testing point. As with the naive approach, it applies <code><a href='conformalCf.html'>conformalCf</a></code> on the data and
produce counterfactual intervals for both Y(1) and Y(0). The ITE intervals are then computed by contrasting the observed outcome
and the interval for the missing potential outcome.</p></li>
</ul>

<p>When <code>side = "above"</code>,
intervals are of form [-Inf, a(x)] and when <code>side = "below"</code> the intervals are of form [a(x), Inf].</p>
<p>When <code>type = "CQR"</code>, <code>quantiles</code> must be a vector of 2, regardless of <code>side</code>. When <code>side = "two"</code>, <code>quantiles</code> will be used in <code>outfun</code> for both Y(1) and Y(0); when <code>side = "above"</code> or <code>"below"</code>, <code>quantiles[1]</code> will be used for Y(0) and <code>quantiles[2]</code> will be used for Y(1).</p>
<p><code>outfun</code> is applied to both Y(1) and Y(0). <code>outfun</code> can be a valid string, including</p><ul>
<li><p>"RF" for random forest that predicts the conditional mean, a wrapper built on <code>randomForest</code> package.
  Used when <code>type = "mean"</code>.</p></li>
<li><p>"quantRF" for quantile random forest that predicts the conditional quantiles, a wrapper built on
  <code>grf</code> package. Used when <code>type = "CQR"</code>.</p></li>
<li><p>"Boosting" for gradient boosting that predicts the conditional mean, a wrapper built on <code>gbm</code>
   package. Used when <code>type = "mean"</code>.</p></li>
<li><p>"quantBoosting" for quantile gradient boosting that predicts the conditional quantiles, a wrapper built on
  <code>gbm</code> package. Used when <code>type = "CQR"</code>.</p></li>
<li><p>"BART" for gradient boosting that predicts the conditional mean, a wrapper built on <code>bartMachine</code>
   package. Used when <code>type = "mean"</code>.</p></li>
<li><p>"quantBART" for quantile gradient boosting that predicts the conditional quantiles, a wrapper built on
  <code>bartMachine</code> package. Used when <code>type = "CQR"</code>.</p></li>
</ul><p>or a function object whose input must include, but not limited to</p><ul>
<li><p><code>Y</code> for outcome in the training data.</p></li>
<li><p><code>X</code> for covariates in the training data.</p></li>
<li><p><code>Xtest</code> for covariates in the testing data.</p></li>
</ul><p>When <code>type = "CQR"</code>, <code>outfun</code> should also include an argument <code>quantiles</code> that is either
a vector of length 2 or a scalar, depending on the argument <code>side</code>. The output of <code>outfun</code>
must be a matrix with two columns giving the conditional quantile estimates when <code>quantiles</code> is
a vector of length 2; otherwise, it must be a vector giving the conditional quantile estimate or
conditional mean estimate. Other optional arguments can be passed into <code>outfun</code> through <code>outparams</code>.</p>
<p><code>lofun</code> and <code>upfun</code> have the same forms as <code>outfun</code> except that the input <code>quantiles</code>
must be scalar when <code>citype = "CQR"</code>, instead of a vector of 2, because only one conditional quantile
is fitted. The argument <code>loquantile</code> is used for <code>lofun</code> and the argument <code>hiquantile</code> is used
for <code>upfun</code>. Moreover, the output must be a vector giving the conditional quantile estimate or conditional mean
estimate. Other optional arguments can be passed into <code>lofun</code> through <code>loparams</code> and <code>upfun</code>
through <code>upparams</code>.</p>
<p><code>psfun</code> can be a valid string, including</p><ul>
<li><p>"RF" for random forest that predicts the propensity score, a wrapper built on <code>randomForest</code> package.
  Used when <code>type = "mean"</code>.</p></li>
<li><p>"Boosting" for gradient boosting that predicts the propensity score, a wrapper built on <code>gbm</code>
   package. Used when <code>type = "mean"</code>.</p></li>
</ul><p>or a function object whose input must include, but not limited to</p><ul>
<li><p><code>Y</code> for treatment assignment, a binary vector, in the training data.</p></li>
<li><p><code>X</code> for covariates in the training data.</p></li>
<li><p><code>Xtest</code> for covariates in the testing data.</p></li>
</ul><p>The output of <code>psfun</code> must be a vector of predicted probabilities. Other optional arguments
can be passed into <code>psfun</code> through <code>psparams</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Generate potential outcomes from two linear models</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>d</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>beta</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span><span class='op'>)</span>
<span class='va'>Y1</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='va'>beta</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>
<span class='va'>Y0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>

<span class='co'># Generate treatment indicators</span>
<span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
<span class='cn'>T</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>ps</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='cn'>T</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='va'>Y1</span>, <span class='va'>Y0</span><span class='op'>)</span>

<span class='co'># Generate testing data</span>
<span class='va'>ntest</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
<span class='va'>Xtest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>ntest</span> <span class='op'>*</span> <span class='va'>d</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>ntest</span><span class='op'>)</span>

<span class='co'># Inexact nested method</span>
<span class='va'>CIfun</span> <span class='op'>&lt;-</span> <span class='fu'>conformalIte</span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>Y</span>, <span class='cn'>T</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span>, algo <span class='op'>=</span> <span class='st'>"nest"</span>, exact <span class='op'>=</span> <span class='cn'>FALSE</span>, type <span class='op'>=</span> <span class='st'>"CQR"</span>,
                      quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>, outfun <span class='op'>=</span> <span class='st'>"quantRF"</span>, useCV <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='input'><span class='fu'>CIfun</span><span class='op'>(</span><span class='va'>Xtest</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       lower    upper
#&gt; 1 -5.535404 1.652236
#&gt; 2 -2.734280 3.569504
#&gt; 3 -4.409276 2.428634
#&gt; 4 -2.761593 3.246044
#&gt; 5 -4.601320 3.115250</div><div class='input'>
<span class='co'># Exact nested method</span>
<span class='va'>CIfun</span> <span class='op'>&lt;-</span> <span class='fu'>conformalIte</span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>Y</span>, <span class='cn'>T</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span>, algo <span class='op'>=</span> <span class='st'>"nest"</span>, exact <span class='op'>=</span> <span class='cn'>TRUE</span>, type <span class='op'>=</span> <span class='st'>"CQR"</span>,
                      quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>, outfun <span class='op'>=</span> <span class='st'>"quantRF"</span>,  useCV <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='input'><span class='fu'>CIfun</span><span class='op'>(</span><span class='va'>Xtest</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       lower    upper
#&gt; 1 -8.006887 3.518362
#&gt; 2 -5.756215 7.016254
#&gt; 3 -6.451481 4.941770
#&gt; 4 -6.225063 6.755913
#&gt; 5 -6.476378 6.764593</div><div class='input'>
<span class='co'># naive method</span>
<span class='va'>CIfun</span> <span class='op'>&lt;-</span> <span class='fu'>conformalIte</span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>Y</span>, <span class='cn'>T</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span>, algo <span class='op'>=</span> <span class='st'>"naive"</span>, type <span class='op'>=</span> <span class='st'>"CQR"</span>,
                      quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>, outfun <span class='op'>=</span> <span class='st'>"quantRF"</span>,  useCV <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='input'><span class='fu'>CIfun</span><span class='op'>(</span><span class='va'>Xtest</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt;       lower    upper
#&gt; 1 -7.608528 2.942607
#&gt; 2 -4.025057 5.658221
#&gt; 3 -7.506229 5.170186
#&gt; 4 -5.784016 5.770620
#&gt; 5 -7.074514 5.060487</div><div class='input'>
<span class='co'># counterfactual method, Y and T needs to be observed</span>
<span class='va'>pstest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span><span class='op'>(</span><span class='va'>Xtest</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>Ttest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>pstest</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>ntest</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>Y1test</span> <span class='op'>&lt;-</span> <span class='va'>Xtest</span> <span class='op'>%*%</span> <span class='va'>beta</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>ntest</span><span class='op'>)</span>
<span class='va'>Y0test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>ntest</span><span class='op'>)</span>
<span class='va'>Ytest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>Ttest</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='va'>Y1test</span>, <span class='va'>Y0test</span><span class='op'>)</span>
<span class='va'>CIfun</span> <span class='op'>&lt;-</span> <span class='fu'>conformalIte</span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>Y</span>, <span class='cn'>T</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span>, algo <span class='op'>=</span> <span class='st'>"counterfactual"</span>, type <span class='op'>=</span> <span class='st'>"CQR"</span>,
                      quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>, outfun <span class='op'>=</span> <span class='st'>"quantRF"</span>,  useCV <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='input'><span class='fu'>CIfun</span><span class='op'>(</span><span class='va'>Xtest</span>, <span class='va'>Ytest</span>, <span class='va'>Ttest</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt; <span class='warning'>Warning: the condition has length &gt; 1 and only the first element will be used</span></div><div class='output co'>#&gt;       lower     upper
#&gt; 1 -4.571894  1.851149
#&gt; 2 -1.376061  3.937992
#&gt; 3 -5.953691 -1.692984
#&gt; 4 -3.751595  1.802698
#&gt; 5 -4.457433  2.677075</div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Lihua Lei.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


