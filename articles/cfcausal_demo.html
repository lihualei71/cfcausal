<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Tutorial of `cfcausal` package • cfcausal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Tutorial of `cfcausal` package">
<meta property="og:description" content="cfcausal">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cfcausal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cfcausal_demo.html">A Tutorial of `cfcausal` package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cfcausal_demo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Tutorial of <code>cfcausal</code> package</h1>
                        <h4 class="author">Lihua Lei</h4>
            
            <h4 class="date">2020-08-16</h4>
      
      
      <div class="hidden name"><code>cfcausal_demo.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>cfcausal</code> package implements weighted conformal inference-based procedures for counterfactuals and individual treatment effects proposed in <span class="citation">Lei and Candès (2020a)</span> and extended in <span class="citation">Lei and Candès (2020b)</span>. It includes both the weighted split conformal inference described and the weighted cross-validation+, a weighted variant of <span class="citation">Barber et al. (2019)</span>. For each type of conformal inference, both conformalized quantile regression (CQR) <span class="citation">(Romano, Patterson, and Candès 2019)</span> and standard conformal inference are supported. It provides a pool of convenient learners and allows flexible user-defined learners for conditional mean and quantiles. In this tutorial we illustrate the usage of <code>conformalCf</code> for counterfactual inference and <code>conformalIte</code> for inference of individual treatment effects.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># Install the "cfcausal" package from github.</span>
<span class="co"># if (!require("devtools")){</span>
<span class="co">#     install.packages("devtools")</span>
<span class="co"># }</span>
<span class="co"># devtools::install_github("lihualei71/cfcausal")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"cfcausal"</span>)
</pre></div>
</div>
<div id="conformalcf-inference-of-counterfactuals" class="section level1">
<h1 class="hasAnchor">
<a href="#conformalcf-inference-of-counterfactuals" class="anchor"></a><code>conformalCf</code>: inference of counterfactuals</h1>
<p>We illustrate the usage of <code>conformalCf</code> using the numerical study in Section 3.6 of <span class="citation">Lei and Candès (2020a)</span>. Here we choose the simplest scenario with <span class="math inline">\(n = 1000, d = 10\)</span>, homoscedastic errors and independent covariates. We summarize the data-generating process below.</p>
<ul>
<li><p>The covariates <span class="math inline">\(X_{ij}\)</span> are i.i.d. generated from <span class="math inline">\(\mathrm{Unif}([0, 1])\)</span>.</p></li>
<li><p><span class="math inline">\(Y_{i}(0)\equiv 0\)</span></p></li>
<li><p><span class="math inline">\(\mathbb{E}[Y_{i}(1) \mid X_{i}] = f(X_{i1})f(X_{i2})\)</span> where <span class="math display">\[f(x) = \frac{2}{1 + \exp(-12(x - 0.5))}\]</span></p></li>
<li><p><span class="math inline">\(Y_{i}(1) = \mathbb{E}[Y_{i}(1) \mid X_{i}] + \epsilon_{i}\)</span> where <span class="math inline">\(\epsilon_{i}\stackrel{i.i.d.}{\sim}N(0, 1)\)</span>.</p></li>
<li><p>The propensity score <span class="math inline">\(e(x) \triangleq P(T_{i} = 1\mid X_{i} = x)\)</span> is set as follows: <span class="math display">\[e(x) = \frac{1}{4}(1 + \beta_{2, 4}(x),\]</span> where <span class="math inline">\(\beta_{2, 4}(x)\)</span> is the cdf of the Beta-distribution with parameters <span class="math inline">\(2\)</span> and <span class="math inline">\(4\)</span>.</p></li>
</ul>
<p>The outcome variable <code>Y</code> used by <code>conformalCf</code> should be a mixture of observed values and missing values while the covariate matrix <code>X</code> should have no missing values. It can handle general missing value problems with ignorable missing mechanisms. The inference of counterfactuals under the potential outcome framework with ignorable treatment assignment is thus a special case.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Generate data</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)
<span class="kw">genY</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">X</span>){
    <span class="fl">2</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="fl">12</span> <span class="op">*</span> (<span class="kw">X</span>[, <span class="fl">1</span>] <span class="op">-</span> <span class="fl">0.5</span>))) <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="fl">12</span> <span class="op">*</span> (<span class="kw">X</span>[, <span class="fl">2</span>] <span class="op">-</span> <span class="fl">0.5</span>))) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n</span>)
}
<span class="kw">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="kw">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">n</span> <span class="op">*</span> <span class="kw">d</span>), nrow = <span class="kw">n</span>, ncol = <span class="kw">d</span>)
<span class="kw">Y</span> <span class="op">&lt;-</span> <span class="fu">genY</span>(<span class="kw">X</span>)
<span class="kw">ps</span> <span class="op">&lt;-</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">pbeta</a></span>(<span class="kw">X</span>[, <span class="fl">1</span>], <span class="fl">2</span>, <span class="fl">4</span>)) <span class="op">/</span> <span class="fl">4</span>
<span class="kw">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw">ps</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">n</span>))
<span class="kw">Y</span>[<span class="op">!</span><span class="kw">T</span>] <span class="op">&lt;-</span> <span class="fl">NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">Y</span>)
</pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
## -2.5271 -0.3099  0.6025  0.8511  1.7124  5.8222     427</code></pre>
<p>Let <span class="math inline">\((X, Y)\)</span> denote a generic observation and <span class="math inline">\(T\)</span> denote the indicator of <span class="math inline">\(Y\)</span> being observed. <code>conformalCf</code> can produce intervals with three types of coverage guarantees:</p>
<ul>
<li><p>when <code>estimand = "unconditional"</code>, <span class="math inline">\(\mathbb{P}(Y\in \hat{C}(X))\ge 1 - \alpha\)</span>;</p></li>
<li><p>when <code>estimand = "nonmissing"</code>, <span class="math inline">\(\mathbb{P}(Y\in \hat{C}(X)\mid T = 1)\ge 1 - \alpha\)</span>;</p></li>
<li><p>when <code>estimand = "missing"</code>, <span class="math inline">\(\mathbb{P}(Y\in \hat{C}(X)\mid T = 0)\ge 1 - \alpha\)</span>.</p></li>
</ul>
<p>Throughout the tutorial, we focus on the first type of coverage guarantee. We start by using weighed split conformalized quantile regression (CQR) with the built-in quantile random forest to illustrate the usage. See <code><a href="../reference/conformalCf.html">?conformalCf</a></code> for a list of built-in learners.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>,
                   quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),
                   outfun = <span class="st">"quantRF"</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Loading required namespace: grf</code></pre>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw">obj</span>)
</pre></div>
<pre><code>## [1] "conformalSplit"</code></pre>
<p><code>obj</code> is a <code>conformalSplit</code> object that is produced by the function <code>conformal</code>. See <code><a href="../reference/conformal.html">?conformal</a></code> for details. To generate counterfactual intervals, we first generate <span class="math inline">\(5\)</span> testing points.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">ntest</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="kw">Xtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">ntest</span> <span class="op">*</span> <span class="kw">d</span>), nrow = <span class="kw">ntest</span>, ncol = <span class="kw">d</span>)
</pre></div>
<p>Then we call the generic <code>predict</code> function on <code>obj</code> to obtain the intervals. See <code><a href="../reference/predict.conformalSplit.html">?predict.conformalSplit</a></code> for details.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">CI</span>
</pre></div>
<pre><code>##       lower    upper
## 1 -1.173787 3.417608
## 2 -1.173787 3.417608
## 3 -1.213149 3.689711
## 4 -1.210184 2.769178
## 5 -1.081784 3.784355</code></pre>
<p>The output is a data.frame with two columns with <code>lower</code> being the lower confidence bound and <code>upper</code> being the upper confidence bound. As a sanity check, we generate <span class="math inline">\(10000\)</span> testing points with their outcomes and compute the empirical coverage. As expected the coverage is above <span class="math inline">\(1 - \alpha = 0.9\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">ntest_large</span> <span class="op">&lt;-</span> <span class="fl">10000</span>
<span class="kw">Xtest_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">ntest_large</span> <span class="op">*</span> <span class="kw">d</span>), nrow = <span class="kw">ntest_large</span>, ncol = <span class="kw">d</span>)
<span class="kw">Ytest_large</span> <span class="op">&lt;-</span> <span class="fu">genY</span>(<span class="kw">Xtest_large</span>)
<span class="kw">CI_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest_large</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">CI_large</span>[, <span class="fl">1</span>] <span class="op">&lt;=</span> <span class="kw">Ytest_large</span> <span class="op">&amp;</span> <span class="kw">CI_large</span>[, <span class="fl">2</span>] <span class="op">&gt;=</span> <span class="kw">Ytest_large</span>)
</pre></div>
<pre><code>## [1] 0.9168</code></pre>
<p>Now we tweak the inputs of <code>conformalCf</code>. First we can replace split-CQR with CQR-CV+ to improve the data efficiency by setting <code>useCV = TRUE</code>. The default number of folds is <code>nfolds = 10</code>. It will be much slower than the split-CQR due to the repeated fitting.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>,
                   quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),
                   outfun = <span class="st">"quantRF"</span>, useCV = <span class="fl">TRUE</span>,
                   nfolds = <span class="fl">10</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##       lower    upper
## 1 -1.353587 3.129954
## 2 -1.377106 2.942385
## 3 -1.443872 3.345340
## 4 -1.349156 2.318767
## 5 -1.107140 3.469790</code></pre>
<p>Second, we can replace CQR with the standard conformal inference that calibrates an estimate of conditional mean. In this case, the built-in <code>"quantRF"</code> learner should be also be replaced by the built-in <code>"RF"</code> learner. See <code><a href="../reference/conformalCf.html">?conformalCf</a></code> for a list of available learners.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"mean"</span>,
                   outfun = <span class="st">"RF"</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Loading required namespace: randomForest</code></pre>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##       lower    upper
## 1 -1.334169 2.364875
## 2 -1.842401 1.856643
## 3 -1.316462 2.382582
## 4 -1.824318 1.874726
## 5 -1.268249 2.430795</code></pre>
<p>Third, <code>conformalCf</code> produces two-sided intervals under the default setting. One-sided intervals can be produced by changing the argument <code>side</code> to <code>above</code> and <code>below</code>. In both cases, the argument <code>quantiles</code> should be a scalar.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>, side = <span class="st">"above"</span>,
                   quantiles = <span class="fl">0.95</span>,
                   outfun = <span class="st">"quantRF"</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##   lower    upper
## 1  -Inf 2.308802
## 2  -Inf 1.715765
## 3  -Inf 2.296971
## 4  -Inf 1.289754
## 5  -Inf 2.452581</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>, side = <span class="st">"below"</span>,
                   quantiles = <span class="fl">0.05</span>,
                   outfun = <span class="st">"quantRF"</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##        lower upper
## 1 -1.1253952   Inf
## 2 -1.1674443   Inf
## 3 -1.1035450   Inf
## 4 -0.9428755   Inf
## 5 -0.6127760   Inf</code></pre>
<p>Next, we can replace the built-in learners with any user-defined function that satisfies certain minimal requirements. For CQR, <code>outfun</code> should have at least four inputs: <code>Y</code> for the outcome, <code>X</code> for the covariates, <code>Xtest</code> for the covariates of testing points and <code>quantiles</code> that is either a vector of length 2 or a scalar, depending on the argument <code>side</code>.The output of  must be a matrix with two columns giving the conditional quantile estimates when  is a vector of length 2; otherwise, it must be a vector giving the conditional quantile estimate. Here we re-define the quantile random forest from scratch. For this purpose we need to install <code>grf</code> package (<span class="citation">Tibshirani, Athey, and Wager (2019)</span>).</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="co"># Install grf package</span>
<span class="co">if</span> (<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st"><a href="https://github.com/grf-labs/grf">"grf"</a></span>)){
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"grf"</span>)
}
</pre></div>
<pre><code>## Loading required package: grf</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="co"># User-defined quantile random forest</span>
<span class="kw">quantRF</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">Y</span>, <span class="kw">X</span>, <span class="kw">Xtest</span>, <span class="kw">quantiles</span>, <span class="kw">...</span>){
    <span class="kw">fit</span> <span class="op">&lt;-</span> <span class="kw">grf</span>::<span class="fu"><a href="https://rdrr.io/pkg/grf/man/quantile_forest.html">quantile_forest</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, quantiles = <span class="kw">quantiles</span>, <span class="kw">...</span>)
    <span class="kw">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">fit</span>, <span class="kw">Xtest</span>, quantiles = <span class="kw">quantiles</span>)
    <span class="co">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">quantiles</span>) <span class="op">==</span> <span class="fl">1</span>){
        <span class="kw">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw">res</span>)
    } <span class="co">else</span> {
        <span class="kw">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">res</span>)
    }
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">res</span>)
}
<span class="co"># conformalCf with user-defined quantRF</span>
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>,
                   quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),
                   outfun = <span class="kw">quantRF</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##       lower    upper
## 1 -1.599284 3.192579
## 2 -1.599284 3.175531
## 3 -1.782791 3.853756
## 4 -1.599284 2.910702
## 5 -1.290546 3.853756</code></pre>
<p>For standard conformal inference, <code>outfun</code> should have at least three inputs: <code>Y</code> for the outcome, <code>X</code> for the covariates, and <code>Xtest</code> for the covariates of testing points. The output of  must be a vector giving the conditional quantile estimate. Here we define a linear learner.</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="kw">linearReg</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">Y</span>, <span class="kw">X</span>, <span class="kw">Xtest</span>){
    <span class="kw">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">X</span>)
    <span class="kw">Xtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">Xtest</span>)
    <span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(Y = <span class="kw">Y</span>, <span class="kw">X</span>)
    <span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">Y</span> <span class="op">~</span> <span class="kw">.</span>, data = <span class="kw">data</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">fit</span>, <span class="kw">Xtest</span>))
}
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"mean"</span>, 
                   outfun = <span class="kw">linearReg</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##       lower    upper
## 1 -1.180282 2.818223
## 2 -1.634871 2.363633
## 3 -1.222730 2.775774
## 4 -2.679271 1.319234
## 5 -1.188933 2.809571</code></pre>
<p>Finally, we can replace the built-in propensity score method with any user-defined function that satisfies certain minimal requirements. Specifically <code>psfun</code> should have at least three inputs: <code>Y</code> for the binary outcome, <code>X</code> for the covariates, <code>Xtest</code> for the covariates of testing points. The output of  must be a vector of predicted probabilities. Here we define a learner via logistic regression.</p>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="kw">logitReg</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">Y</span>, <span class="kw">X</span>, <span class="kw">Xtest</span>, <span class="kw">...</span>){
    <span class="kw">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">X</span>)
    <span class="kw">Xtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw">Xtest</span>)
    <span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(Y = <span class="kw">Y</span>, <span class="kw">X</span>)
    <span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="kw">Y</span> <span class="op">~</span> <span class="kw">.</span>, data = <span class="kw">data</span>, family = <span class="st">"binomial"</span>, <span class="kw">...</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">fit</span>, <span class="kw">Xtest</span>, type = <span class="st">"response"</span>))
}
<span class="kw">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalCf.html">conformalCf</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, type = <span class="st">"CQR"</span>, quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>),
                   outfun = <span class="st">"quantRF"</span>, psfun = <span class="kw">logitReg</span>, useCV = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">obj</span>, <span class="kw">Xtest</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>##        lower    upper
## 1 -1.2533483 3.246982
## 2 -1.4459232 3.277766
## 3 -1.0002691 3.549189
## 4 -1.2533483 2.606816
## 5 -0.8417575 3.549869</code></pre>
</div>
<div id="conformalite-inference-of-individual-treatment-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#conformalite-inference-of-individual-treatment-effects" class="anchor"></a><code>conformalIte</code>: inference of individual treatment effects</h1>
<p>We illustrate the usage of <code>conformalCf</code> using the same numerical example as above except that <span class="math inline">\(Y(0)\)</span> is generated as a standard normal variable.</p>
<div class="sourceCode" id="cb53"><pre class="downlit">
<span class="co"># Generate training data</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">2020</span>)
<span class="kw">genY</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">X</span>){
    <span class="fl">2</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="fl">12</span> <span class="op">*</span> (<span class="kw">X</span>[, <span class="fl">1</span>] <span class="op">-</span> <span class="fl">0.5</span>))) <span class="op">*</span> <span class="fl">2</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="fl">12</span> <span class="op">*</span> (<span class="kw">X</span>[, <span class="fl">2</span>] <span class="op">-</span> <span class="fl">0.5</span>))) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n</span>)
}
<span class="kw">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="kw">d</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="kw">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">n</span> <span class="op">*</span> <span class="kw">d</span>), nrow = <span class="kw">n</span>, ncol = <span class="kw">d</span>)
<span class="kw">Y1</span> <span class="op">&lt;-</span> <span class="fu">genY</span>(<span class="kw">X</span>)
<span class="kw">Y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n</span>)
<span class="kw">ps</span> <span class="op">&lt;-</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">pbeta</a></span>(<span class="kw">X</span>[, <span class="fl">1</span>], <span class="fl">2</span>, <span class="fl">4</span>)) <span class="op">/</span> <span class="fl">4</span>
<span class="kw">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw">ps</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">n</span>))
<span class="kw">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">T</span> <span class="op">==</span> <span class="fl">1</span>, <span class="kw">Y1</span>, <span class="kw">Y0</span>)

<span class="co"># Generate testing data</span>
<span class="kw">ntest</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="kw">Xtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">ntest</span> <span class="op">*</span> <span class="kw">d</span>), nrow = <span class="kw">ntest</span>, ncol = <span class="kw">d</span>)
<span class="kw">pstest</span> <span class="op">&lt;-</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">pbeta</a></span>(<span class="kw">Xtest</span>[, <span class="fl">1</span>], <span class="fl">2</span>, <span class="fl">4</span>)) <span class="op">/</span> <span class="fl">4</span>
<span class="kw">Ttest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw">pstest</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">ntest</span>))
<span class="kw">Y1test</span> <span class="op">&lt;-</span> <span class="fu">genY</span>(<span class="kw">Xtest</span>)
<span class="kw">Y0test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">ntest</span>)
<span class="kw">Ytest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">Ttest</span> <span class="op">==</span> <span class="fl">1</span>, <span class="kw">Y1test</span>, <span class="kw">Y0test</span>)
</pre></div>
<p><code>conformalIte</code> supports four algorithms: the nested approach with exact and inexact calibration for cases with both potential outcomes missing, the naive approach for cases with both potential outcomes missing and the counterfactual inference for cases with only one potential outcome missing. The output of <code>conformalIte</code> is a function that outputs the interval estimates on a given dataset. When <code>algo = "nest"</code> or <code>"naive"</code>, it take a single input <code>X</code>; when <code>algo = "counterfactual"</code>, it takes three inputs <code>X</code>, <code>Y</code> and <code>T</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="co"># Inexact nested method</span>
<span class="kw">CIfun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalIte.html">conformalIte</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, <span class="kw">T</span>, alpha = <span class="fl">0.1</span>, algo = <span class="st">"nest"</span>, exact = <span class="fl">FALSE</span>, type = <span class="st">"CQR"</span>,
                      quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), outfun = <span class="st">"quantRF"</span>, useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit">
<span class="fu">CIfun</span>(<span class="kw">Xtest</span>)
</pre></div>
<pre><code>##       lower    upper
## 1 -1.558885 3.630447
## 2 -1.674914 2.903295
## 3 -1.294911 3.832546
## 4 -1.243285 3.843100
## 5 -1.642957 3.007884</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit">
<span class="co"># Exact nested method</span>
<span class="kw">CIfun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalIte.html">conformalIte</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, <span class="kw">T</span>, alpha = <span class="fl">0.1</span>, algo = <span class="st">"nest"</span>, exact = <span class="fl">TRUE</span>, type = <span class="st">"CQR"</span>,
                      quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), outfun = <span class="st">"quantRF"</span>,  useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit">
<span class="fu">CIfun</span>(<span class="kw">Xtest</span>)
</pre></div>
<pre><code>##       lower    upper
## 1 -4.214026 5.614733
## 2 -4.309331 5.307646
## 3 -3.730314 7.094280
## 4 -4.078257 5.984140
## 5 -4.413876 5.343038</code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit">
<span class="co"># naive method</span>
<span class="kw">CIfun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalIte.html">conformalIte</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, <span class="kw">T</span>, alpha = <span class="fl">0.1</span>, algo = <span class="st">"naive"</span>, type = <span class="st">"CQR"</span>,
                      quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), outfun = <span class="st">"quantRF"</span>,  useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit">
<span class="fu">CIfun</span>(<span class="kw">Xtest</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##       lower    upper
## 1 -3.340135 6.716458
## 2 -3.936419 6.017972
## 3 -3.301186 6.783034
## 4 -3.607648 6.740864
## 5 -3.936641 5.878697</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit">
<span class="co"># counterfactual method, Y and T needs to be observed</span>
<span class="kw">CIfun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conformalIte.html">conformalIte</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>, <span class="kw">T</span>, alpha = <span class="fl">0.1</span>, algo = <span class="st">"counterfactual"</span>, type = <span class="st">"CQR"</span>,
                      quantiles = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), outfun = <span class="st">"quantRF"</span>,  useCV = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit">
<span class="fu">CIfun</span>(<span class="kw">Xtest</span>, <span class="kw">Ytest</span>, <span class="kw">Ttest</span>)
</pre></div>
<pre><code>## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used

## Warning in if (class(X) != "data.frame") {: the condition has length &gt; 1 and
## only the first element will be used</code></pre>
<pre><code>##        lower    upper
## 1 -2.6537037 3.039267
## 2 -1.4492544 2.132761
## 3 -0.9445100 4.905721
## 4  1.5125863 4.636669
## 5 -0.2817008 2.940193</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-barber2019predictive">
<p>Barber, Rina Foygel, Emmanuel J Candès, Aaditya Ramdas, and Ryan J Tibshirani. 2019. “Predictive Inference with the Jackknife+.” <em>arXiv Preprint arXiv:1905.02928</em>.</p>
</div>
<div id="ref-lei2020conformal">
<p>Lei, Lihua, and Emmanuel Candès. 2020a. “Conformal Inference of Counterfactuals and Individual Treatment Effects.” <em>arXiv Preprint arXiv:2006.06138</em>.</p>
</div>
<div id="ref-lei2020weighted">
<p>———. 2020b. “Theory of Weighted Conformal Inference.” <em>Unpublished Manuscript</em>.</p>
</div>
<div id="ref-romano2019conformalized">
<p>Romano, Yaniv, Evan Patterson, and Emmanuel Candès. 2019. “Conformalized Quantile Regression.” In <em>Advances in Neural Information Processing Systems</em>, 3538–48.</p>
</div>
<div id="ref-grf">
<p>Tibshirani, Julie, Susan Athey, and Stefan Wager. 2019. <em>Grf: Generalized Random Forests</em>. <a href="https://CRAN.R-project.org/package=grf">https://CRAN.R-project.org/package=grf</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lihua Lei.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
